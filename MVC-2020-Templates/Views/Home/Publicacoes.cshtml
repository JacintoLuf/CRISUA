@{
    //Layout = "_3ColsLayout";
    ViewData["Title"] = "Publicações";
    //List<MVC_2020_Business.Models.Product> publicacoes = ViewBag.Publicacoes;
    //List<MVC_2020_Business.Models.Product> publicacoes = ViewBag.PublicacoesRIA;
    List<MVC_2020_Business.Models.Work> works = ViewBag.PublicacoesPTCris;
    //var worksMeu = ViewBag.PublicacoesOrcid;
    var pubsInBD = ViewBag.worksInBD;

    //var listTitle = @MVC_2020_Business.Services.DatabaseServices.select(@MVC_2020_Template.Controllers.HomeController.DB(), "Publication", "Synced", "0");
    var importPub = ViewBag.import;
}

@*<h2>@importPub</h2>*@
<div class="ui grid">
    <div class="six wide column"><h2>@ViewData["Title"]</h2></div>



    <div class="six wide column">
        <div class="ui category search">
            <div class="ui icon input">
                <input class="prompt" type="text" placeholder="Search articles...">
                <i class="search icon"></i>
            </div>
            <div class="results"></div>
        </div>
    </div>
</div>
<div class="container">
    
        <div class="ui two column centered grid">
            <div class="column">
                <form action="publicacoes" method="post">
                    <input type="hidden" name="import" value="True" />
                    <button type="submit" class="ui primary button">Importar</button>
                </form>
                    <button class="ui primary button" onclick="saveAll()">Guardar@*@Html.ActionLink("GO", "Detail", "Home", null)*@</button>
            </div>
        </div>
    
    <br />
    <div id="hidden_info" style="display:none; background-color:lightgray;border-radius:5px">
        <br />
        <p>&nbsp Utilize as setas <i class="arrow alternate circle right icon"></i> e <i class="arrow alternate circle left icon"></i> para escolher as publicações que quer colocar no RIA.</p>
        <br />
        <p>&nbsp Utilize o botão <button class="ui primary button">save</button> para confirmar e guardar a esolha das publicações. As  publicações irão para a página @Html.ActionLink("Detalhes", "Detail", "Home", null)</p>
    </div>
    <br />
    <div class="ui grid">
        <div class="six wide column">ORCID</div>
        <div class="one wide column"></div>
        <div class="six wide column">RIA</div>
        @*<div class="one wide column"><button class="ui primary button" onclick="saveAll()" href="@Url.Action("Detail", "Home")">Save</button></div>*@
        <div class="two wide column">
            <button type="button" class="ui primary button" onclick="toggleText()"><i class="info circle icon"></i>Ajuda</button>
        </div>
    </div>

    <div id="scrollPub" class="ui grid">

        <br />
        @{ var count = 0;
            var seta1 = "seta1_" + count;
            var seta2 = "seta2_" + count;
            var info = "info_" + count;
        }
        @*@foreach (var work in works)
            {
                count++;
                seta1 = "seta1_" + count;
                seta2 = "seta2_" + count;
                info = "info_" + count;
                <div class="six wide column" data-tooltip="@string.Join("\n ", work.contributors.ToString(work.publicationDate.year.value))" data-position="bottom left">
                    @work.title.title
                </div>
                <div class="two wide column">
                    <i id="@seta1" class="arrow alternate circle right icon" onclick="OrcidToRia(@Newtonsoft.Json.JsonConvert.SerializeObject(work), @count)"></i>
                    <i id="@seta2" class="arrow alternate circle left icon" style="display:none" onclick="CancelOrcidToRia(@Newtonsoft.Json.JsonConvert.SerializeObject(work), @count)"></i>
                </div>
                <div id="@count" class="six wide column"></div>

            }*@
       

            @foreach (var pub in pubsInBD)
            {
                count++;
                seta1 = "seta1_" + count;
                seta2 = "seta2_" + count;
                info = "info_" + count;
                <div class="six wide column" data-tooltip="@string.Join(" ; ", pub["Autores"])" data-position="bottom left">
                    <href onmouseover="" style="cursor:pointer;" onclick="sendToDetails(@Newtonsoft.Json.JsonConvert.SerializeObject(pub))">@pub["titulo"]</href>
                </div>
                <div class="two wide column">
                    <i id="@seta1" class="arrow alternate circle right icon" onclick="OrcidToRia(@Newtonsoft.Json.JsonConvert.SerializeObject(pub), @count)"></i>
                    <i id="@seta2" class="arrow alternate circle left icon" style="display:none" onclick="CancelOrcidToRia(@Newtonsoft.Json.JsonConvert.SerializeObject(pub), @count)"></i>
                </div>
                <div id="@count" class="six wide column"></div>
            }
        

    </div>

</div>
@if (works != null)
{
    foreach (var work in works)
    {
        <p>@work.title.title</p>
    }
}

<script>
    var objs = [];

    function sendToDetails(obj) {
        console.log(obj);
        $.post("PublicationDetails_Helper", { obj: JSON.stringify(obj) }, function (data) {
            window.location.href = data;
        });
        @* window.open('@Url.Action("Publication_details","Home")');*@
    }

    function OrcidToRia(obj, idDiv) {
        console.log(obj);
        var div = document.getElementById("" + idDiv);
        if (typeof (div) != 'undefined' && div != null) {
            var seta1 = document.getElementById("seta1_" + idDiv);
            seta1.style.display = "none";
            var seta2 = document.getElementById("seta2_" + idDiv);
            seta2.style.display = "block";
            div.innerHTML = obj["titulo"];
            objs.push(obj["titulo"]);
        }
    }

    function CancelOrcidToRia(obj, idDiv) {
        console.log(obj);
        var div = document.getElementById("" + idDiv);
        if (typeof (div) != 'undefined' && div != null) {
            var seta1 = document.getElementById("seta1_" + idDiv);
            seta1.style.display = "block";
            var seta2 = document.getElementById("seta2_" + idDiv);
            seta2.style.display = "none";
            div.innerHTML = null;
            objs.pop(obj["titulo"]);
        }
    }

    function saveAll() {
        $.post("SavePub", { works: JSON.stringify(objs) }, function (data) {
            //alert("Go to Details");
            window.location.href = "PublicacoesSalvas";
            //$("#main_area").html(data);
        });
        //window.open('@Url.Action("Detail", "Home")', "_blank");
        //window.open('@Url.Action("Detail", "Home")');
        //var workss = JSON.stringify({ 'works': objs });

        //$.ajax({
        //    contentType: 'application/json; charset=utf-8',
        //    dataType: 'json',
        //    type: 'POST',
        //    url: '/Home/SavePub',
        //    data: workss,
        //    success: function (data) {
        //        alert("Data: " + data);
        //    },
        //    failure: function (data) {
        //        alert("Data: " + data);
        //    }
        //});
    }
    function toggleText() {
        var text = document.getElementById("hidden_info");
        if (text.style.display === "none") {
            text.style.display = "block";
        } else {
            text.style.display = "none";
        }
    }



    var tag = document.getElementById('hidden_info');
    var button = document.querySelector('button');
    button.addEventListener('click', function () {
        tag.classList.toggle('hidden_info');
    });

</script>

@*@section RightColumn{
        Recursos adicionais:
        <ul>
            <li>
                <a href="https://fomantic-ui.com" target="_blank">Fomantic-UI</a>
            </li>
        </ul>
    }*@
